<!DOCTYPE html>
<html lang="de">

<head>
    <title>Tips &amp; Tricks für Profis</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../style.css">
    <meta name="author" content="Nikolas Bergerhoff, N.J.W. Cuppen, Yves Forkl, Gert Harlacher, Oliver Rahm, Frank Sander, tr">
    <meta name="64er.issue" content="3/86">
    <meta name="64er.pages" content="80-82">
    <meta name="64er.head1" content="Tips und Tricks">
    <meta name="64er.head2" content="C 64">
    <meta name="64er.toc_title" content="für Profis">
    <meta name="64er.toc_category" content="Listings zum Abtippen|Tips und Tricks">
    <meta name="64er.index_title" content="Tips & Tricks für Profis">
    <meta name="64er.index_category" content="Tips & Tricks C 64|Profis">
    <meta name="64er.id" content="tips_profis">
</head>

<body>
    <article>
        <h1>Tips &amp; Tricks für Profis</h1>
        <p class="intro">Auch diesmal haben wir für die Profis unter unseren Lesern einige interessante Hinweisa Beachtenswert ist unter anderem »das geheimnisvolle, reverse SHIFT-M«.</p>

        <p>Schalten Sie den Reverse-Modus ein und drücken Sie dann die Tastenkombination SHIFT-M. Was dieser entstandene reverse Schrägbalken alles bewirken kann, möchte ich kurz schildern:</p>

        <h3>1. Innerhalb von REM-Zeilen</h3>

        <p>Geben Sie eine Zeilenummer und REM ”” ein. Nun löschen Sie das zweite Hochkomma mit der DEL-Taste, schalten den Reverse-Modus ein und drücken die Tastenkombination SHIFT-M. Schalten Sie den Reverse-Modus wieder aus und setzen abermals ein Hochkomma, das Sie anschließend mit der DEL-Taste wieder löschen. Nun können Sie wie innerhalb eines PRINT-Befehls einen Text mit Farbcodes etc. eingeben. Nach der Eingabe drücken Sie die RETURN-Taste und listen das Programm. Sie werden erstaunt sein. Zur Veranschaulichung soll folgende Zeile gelten (die Kommata nicht mit eintippen):</p>

        <p>10 REM " "{DEL, RVSON, SHIFTM, RVSOFF} "{DEL, SHIFTCLR/HOME, WHITE, RVSON} This Program is protected {RVSOFF, DARK BLUE}"</p>

        <h3>2. Im Directory</h3>

        <p>Geben Sie »SAVE« ein und erzeugen Sie den reversen Schrägbalken wie oben beschrieben. Dann tippen Sie den Programmnamen mit beliebig vielen Steuerzeichen (insgesamt 16 Zeichen) ein und schließen die Eingabe mit ”,8 und RETURN ab. Auch hier zur Veranschaulichung wieder ein Beispiel:</p>

        <p>SAVE " " {DEL, RVSON, SHIFT M, RVSOFF} " {DEL, RVSON} TEST {RVSOFF} ",8</p>

        <p>Alle Codes werden ebenfalls aktiviert, wenn Sie eingeben: SAVE CHR$ (34) + {RVSON} Test {RVSOFF} ",8</p>

        <h3>3. Als Programmschutz</h3>

        <p>Wenn Sie am Anfang einer Programmzeile PRINT” {reverser Schrägbalken}” und danach weitere Basic-Befehle eingeben, können diese nach Drücken der RETURN-Taste nicht mehr geändert werden (nur durch Zeile löschen oder mit einem Monitor). Beim Listen des Programms werden die nachfolgenden Befehle um eine oder mehrere Zeilen nach unten gerückt (je nach dem, wieviele reverse Schrägbalken Sie in dem PRINT-Befehl verwendet haben), 80 Zeichen pro Zeile werden meistens überschritten. Will man diese Zeile durch Return abermals speichern, so wird nur der PRINT-Befehl gespeichert, alle anderen nachfolgenden Befehle gehen verloren. Ein Beispiel: 10 PRINT" " {DEL ,RVSON ,SHIFTM ,RVSOFF} ":PRINT "COPYRIGHT BY 64'ER-REDAKTION"</p>

        <p>Nachdem Sie diese Zeile eingetippt haben und RETURN gedrückt haben, versuchen Sie einmal, den in den Hochkommata des zweiten PRINT-Befehls stehenden Text auszubessern. Nach dem Ausbesssern und RETURN-Drücken tritt entweder ein Syntax Error auf und die Zeile bleibt unverändert, oder in der Zeile 10 steht nur mehr PRINT”.</p>

        <h3>4. Als Listschutz</h3>

        <p>Geben Sie das erste Beispiel ein, fügen Sie nach dem letzten Hochkomma noch das Zeichen SHIFT L hinzu, drücken Sie RETURN. Nun tippen Sie im Direktmodus POKE 2052,255 ein und speichern das Programm. Nach dem Laden ist der Listschutz noch immer vorhanden.</p>

        <p>Durch diesen POKE bekommt die erste Zeile in einem Programm eine unzulässige Zeilennummer (größer als 63999). Sie kann daher nicht mehr gelöscht werden. Das Listen des Programms wird bei der ersten Zeile abgebrochen, Befehle wie LIST 20- (oder ähnliches) werden auch nicht ausgeführt, da der Computer glaubt, die erste Zeile sei wegen der hohen Zeilennummer die letzte. Der Listenschutz kann jedoch mit POKE 2052,0 wieder aufgehoben werden.</p>

        <address class="author">(Gert Harlacher/tr)</address>

        <h2>Versteckspiel mit dem Directory</h2>

        <p>Wenn eine Diskette mit "N:NAME" + CHR$(O) + CHR$ (0) + CHR$ (0) +", ID" formatiert wird, so wird beim Laden und Auflisten des Directories nur noch der Name der Diskette angezeigt. Der Interpreter »denkt« nämlich, daß das Directory nach den drei Nullen zu Ende ist. Die Programme auf dieser Diskette lassen sich aber trotzdem noch laden.</p>

        <p>Ein weiterer Trick besteht darin, beim Speichern eines Programms an den Namen ein »,S,W« anzuhängen (also zum Beispiel SAVE "TEST, S, W", 8).</p>

        <p>Im Directory steht dieses File nun unter »SEQ« vermerkt. Wer versucht, dieses Programm »normal« mit LOAD zu laden, der wird von der Floppy die Fehlermeldung »64, FILE TYPE MISMATCH« erhalten.</p>

        <p>Der Kundige jedoch wird das Programm mit »LOAD "NAME, S,R",8« laden, und sich des gelungenen Tricks erfreuen. Beide Methoden kombiniert ergeben einen recht wirkungsvollen Programmschutz.</p>

        <address class="author">(Oliver Rahm/tr)</address>

        <h2>Englisch für Fortgeschrittene</h2>

        <p>Geben sie einmal folgende kleine Basic-Zeile sorgfältig ein.</p>

        <figure>
            <pre data-filename="engl.f.fortg." data-name="Englisch für Fortgeschrittene"></pre>
        </figure>

        <p>Wenn Sie die Zeile listen, sehen Sie nichts Ungewöhnliches. Löschen Sie nun das Anführungszeichen hinter der REM-Anweisung und listen Sie die Zeile. Mehr wird hier nicht verraten. Lassen Sie sich überraschen!</p>

        <address class="author">(Yves Forkl/tr)</address>

        <h2>Die mysteriöse Zahl 35072120</h2>

        <p>Zur Erinnerung: In der Ausgabe 1/86 schrieben wir, daß der List-Schutz-»POKE 808,225« durch die Eingabe der Zahl 35072120 wieder zurückgesetzt werden kann. Wir fragten weiterhin, worauf dieses Phänomen zurückzuführen ist.</p>

        <p>Wir danken allen Lesern, die sich bei der Lösung des Problems beteiligt haben. Hier stellvertretend für viele Einsendungen die Erklärung von Frank Sander:</p>

        <p>Nun, was geschieht da, besonders wo der C 64 derartig hohen Zeilennummern sonst nur mit einem kalten Lächeln (auch Syntax-Error genannt) begegnet?</p>

        <p>Es geschieht folgendes:</p>

        <p>Die Eingabewarteschleife ($A480) stellt fest, daß die soeben eingegebene Zeile (»35072120«) mit einer Ziffer beginnt und entscheidet daher, daß es sich um eine in das Programm einzubauende Programmzeile handelt.</p>

        <p>Also übergibt sie die Zeile an die Routine zum Einfügen von Programmzeilen ($A49C).</p>

        <p>Die Einfügeroutine versucht nun als erstes (und in diesem ’ Falle auch als letztes), die Zeilennummer ins Low-/High-Byte-Fbrmat zu verwandeln. Dazu verzweigt sie nach $A96B, wo die Routine liegt, die für das ganze »Wunder« verantwortlich ist. Denn: Ist die Zeilennummer (wie unsere) zu groß, so versucht die Routine verzweifelt, einen Syntax-Error von sich zu geben (aber die entsprechende Ausgabeschleife ist für einen BRANCH-Befehl zu weit entfernt). Also (da man ja unmöglich drei Byte für einen »JMP $AF08« opfern konnte) wird nach $A953 verzweigt, in der Hoffnung, daß der Akku etwas anderes als $89 enthält. Denn $A953 liegt mitten in der ON-GOTO-Routine und dort wird, falls der Akku etwas anderes als den GOTO-Code (eben $89) enthält, zu einem Syntax-Error-Ansprung verzweigt.</p>

        <p>Nur lautet die Zeilennummer 35072120, so ist der im Akku enthaltene »Rest« dummerweise gerade $89, also wird nicht zum Syntax-Error gesprungen, sondern der Prozessor beginnt eine Fahrt ins Ungewisse</p>

        <ul>
            <li>vorbei an total unpassenden Befehlen:</li>
            <li>vorbei an einem JSR CHRGET</li>
            <li>weiter bei einem erneuten Versuch, eine Zeilennummer zu holen (leider ist aber die Zeile zu Ende, also $00)</li>
            <li>dieses $00 ist auch nicht gleich einem Komma&hellip;</li>
        </ul>


        <p>also muß der auf dem Stack liegende Code für ON-GOTO geholt werden (PLA) und das Ganze endet mit einem RTS.</p>

        <p>Nur&hellip; es liegt ja gar kein ON-GOTO-Code auf dem Stack, sondern die Rücksprungadresse aus der Eingabewarteschleife!</p>

        <p>Also wirft der ahnungslose Prozessor das Rücksprung-Low-Byte in die Ecke und hält nun das Rücksprung-High-Byte für ein Low-Byte und das nachfolgende Byte für ein High-Byte. Daraus folgt: der Prozessor springt ins Ungewisse: zu einer Adresse mit Low-Byte $A5. Als High-Byte liegt bei ordnungsgemäß gereinigtem Stack $79 obenauf (ehemaliger Rücksprung nach $A67A während der Basic-Initialisierung). Dies führtzu einem Sprung nach $79A5, wo der Professor hoffentlich auf ein BRK trifft, den sonst&hellip; Einen schweigenden, cursorlosen C 64 hat wohl jeder schon einmal gesehen.</p>

        <p>Aber meist liegt dort ein BRK (oder ein mit TAX gepflasterter Weg dorthin), was den wild gewordenen Computer wieder auf den rechten Weg bringt: Nämlich die NMI-Routine.</p>

        <p>Diese NMI-Routine, die bei unblockierter RUN/STOP-Taste auch über RUN/STOP-RESTORE erreichbar ist, setzt unter anderem den Stop-Vektor (Adresse 808/809!) neu und schon ist das Listing wieder auf den Beinen.</p>

        <p>Hier noch einmal zusammengefaßt die Irrfahrt des C 64:</p>

        <p>TODO TABLE</p>

        <p>Oben auf dem Stack hätte $9E, $A4, $79, $A6 gelegen, das $9E wurde jedoch durch das PLA vom Stack geholt. Also erfolgt ein »Rücksprung« nach $79A5.</p>

        <p>Man kann dies ganz einfach ausprobieren, indem man in den (frisch eingeschalteten) Computer, ein POKE 31141,2 (=$79A5) eingibt. Dies führt dann bei Eingabe von »35072120« zum Absturz des Prozessors. (Befehl $02 = Prozessorabsturz).</p>

        <p>So weit so gut. Nur — hätte es ein POKE 2,0:SYS2 nicht auch getan?</p>

        <address class="author">(Frank Sander/tr)</address>

        <h2>HiRes-Scrolling per Interrupt</h2>

        <p>Wer hat nicht schon solche Titelbilder wie bei dem Spiel »Boulderdash« gesehen? Man hat den Eindruck, als ob der Hintergrund stufenlos scrollen würde, die Schrift aber stehenbliebe. Solch ein Effekt wäre natürlich auch hervorragend für eigene Spielszenen geeignet. Das folgende Maschinenprogramm läuft völlig interruptgesteuert und simuliert diese Funktion in vielfältiger Weise. Das Maschinenprogramm (Listing 1) wird zuerst mit »SYS 49152« gestartet.</p>

        <p>Der erste Befehl schaltet das Pseudo-Scrolling ein. Die Syntax lautet: »SYS 49232,a,b,c«. Nun zu den Parametern: Der Parameter a ist für die Geschwindigkeit zuständig. Sinnvoll sind nur die Werte 1 bis 255, wobei 1 die höchste Geschwindigkeit bewirkt. Der Parameter b kann die Werte 0 oder 1 annehmen. Ist b=0, so wird nach dem Aufruf der gesamte Bildschirm mit dem zu scrollenden Zeichen aufgefüllt. Das ist zu Anfang ein kleiner Kreis, kann aber von Ihnen im Quelltext ge-ändertwerden. Istb=1, sowirdderBildschirmnichtaufgefüllt. Dies wird zum Beispiel in dem Demoprogramm ausgenützt.</p>

        <p>Der Parameter c kann ebenfalls die Werte 0 oder 1 annehmen. Ist c=0, so wird nach oben gescrollt, ist c=1, so wird nach unten gescrollt. Abgeschaltet wird das Ganze mit SYS 49400. Am besten starten Sie zu Anfang das Demoprogramm (Listing 2), um sich mit den Befehlen vertraut zu machen. Zuvor müssen Sie aber das Maschinenprogramm absolut (mit »,8,1«) geladen haben.</p>

        <p>Zur Funktionsweise:</p>

        <p>Zuerst wird der Zeichensatz umkopiert und einige Zeiger initialisiert. Der Trick beim Scrolling besteht darin, daß im Interrupt kontinuierlich das Zeichen »SHIFT-X« (Bildschirmcode= 88) umdefiniert wird. Dadurch scheint der Hintergrund gescrollt zu werden. Unterbrechen Sie doch einmal das Demoprogramm mit RUN/STOP, löschen Sie den Bildschirm und listen das Programm. Sie werden sehen, daß sogar »im Listing« die Zeichen gescrollt werden.</p>

        <p class="source">Hinweis: Wenn Sie die neue Version vom »SMON« besitzen (64’er, Ausgabe 10/85), dann können Sie, nachdem Sie den SMON mit »Y8000« verschoben haben, das zu scrollende Zeichen beliebig mit dem »Z«-Befehl umdefinieren. Die Zeichendefinitionen liegen ab $C107.</p>

        <address class="author">(Bergerhoff/Nikolas/tr)</address>

        <figure>
            <pre data-filename="pseudo-scroll.prg" data-name="HiRes-Scrolling" data-mse=mse1></pre>
            <figcaption>Listing 1. Das Stenoprogrmm zum HiRes-Scrolling. Bitte mit dem MSE eingeben.</figcaption>
        </figure>
        <div class="binary_download" data-filename="pseudo-scroll.prg" data-name="HiRes-Scrolling"></div>

        <figure>
            <pre data-filename="scroll-demo" data-name="HiRes-Scrolling Demo"></pre>
            <figcaption>Listing 2. Ein Demo-Programm zum HiRes-Scrolling.</figcaption>
        </figure>

        <figure>
            <pre>
100  -.BA$C000
110  -;
120  -; *********************
130  -; **  PSEUDO-SCROLL  **
140  -; **-----------------**
150  -; **   (C) 1985 BY   **
160  -; **   N.BERGERHOFF  **
170  -; **   MEISENWEG 22  **
180  -; **  5020 FRECHEN 4 **
190  -; *********************
200  -;
210  -.GL V=53248        ;VIC-ADRESSE
220  -.GL SATZ=53248     ;ZEICHENSATZ
230  -.GL ZIEL=14336     ;ZIEL-ADRESSE
240  -.GL IRQVEC=$0314   ;IRQVECTOR
250  -.GL CHKOM=$AEFD    ;KOMMA?
260  -.GL GETBYT=$B79E   ;BYTE HOLEN
270  -.GL ZDEF=ZIEL+704  ;NEUES ZEICHEN
280  -.GL IRQALT=$EA31   ;ALTE ROUTINE
290  -;
300  -INIT      SEI            ;KEIN INTERRUPT
310  -          LDA $01        ;REG.1
320  -          PHA            ;RETTEN
330  -          AND #251
340  -          STA $01        ;
350  -          LDA #&gt;(SATZ)   ;HIGH-BYTE
360  -          STA $03        ;MERKEN
370  -          LDA #&gt;(ZIEL)   ;NOCHMAL FUER
380  -          STA $05        ;DAS ZIEL
390  -          LDY #00
400  -          STY $02        ;LOW-BYTES
410  -          STY $04        ;LOESCHEN
420  -          LDX #$10
430  -COPY      LDA (02),Y     ;LADEN UND
440  -          STA (04),Y     ;KOPIEREN
450  -          INY
460  -          BNE COPY
470  -          INC $03        ;HIGH-BYTES
480  -          INC $05        ;ERHOEHEN
490  -          DEX
500  -          BNE COPY
510  -          PLA            ;VOM STACK
520  -          STA $01        ;ZURUECKHOLEN
530  -          LDA V+24
540  -          ORA #14        ;NEUER
550  -          STA V+24       ;ZEICHENSATZ
560  -          CLI
570  -          LDA #08        ;K/G SCHRIFT
580  -          JSR $FFD2      ;BLOCKIEREN
590  -IN        LDX #40
600  -          LDY #00
610  -IN1       LDA DEF,X      ;NEUE ZEICHEN-
620  -          STA ZDEF,Y     ;DEFINITION
630  -          INX
640  -          INY
650  -          CPY #08
660  -          BNE IN1
670  -          LDA #05
680  -          STA $FA        ;MERKER1
690  -          LDA #00
700  -          STA $FE        ;MERKER2
710  -          RTS
720  -;
730  -AN        JSR IN
740  -          JSR CHKOM      ;KOMMA?
750  -          JSR GETBYT     ;BYTE HOLEN
760  -          STX SPEED      ;MERKEN
770  -          JSR CHKOM
780  -          JSR GETBYT     ;VIDEQRAM MIT
790  -          CPX #00        ;88 FUELLEN?
800  -          BNE A0
810  -          JSR FULL       ;JA
820  -A0        JSR CHKOM
830  -          JSR GETBYT
840  -          CPX #00        ;HOCH?
850  -          BNE A1
860  -          SEI            ;JA
870  -          LDA #&lt;(IRQ1)
880  -          LDY #&gt;(IRQ1)
890  -          STA IRQVEC
900  -          STY IRQVEC+1
910  -          CLI
920  -          RTS
930  -A1        SEI            ;RUNTER
940  -          LDA #&lt;(IRQ2)
950  -          LDY #&gt;(IRQ2)
960  -          STA IRQVEC
970  -          STY IRQVEC+1
980  -          CLI
990  -          RTS
1000  -;
1010  -FULL      LDX #00        ;VIDEORAM
1020  -          LDA #88        ;MIT 88
1030  -F1        STA 1024,X     ;AUFFUELLEN
1040  -          INX
1050  -          BNE F1
1060  -F2        STA 1280,X
1070  -          INX
1080  -          BNE F2
1090  -F3        STA 1536,X
1100  -          INX
1110  -          BNE F3
1120  -F4        STA 1768,X
1130  -          INX
1140  -          BNE F4
1150  -          RTS
1160  -;
1170  -IRQ1      JSR TIME       ;IST ZEIT
1180  -          BNE BACK       ;ERREICHT?
1190  -          INC $FA
1200  -          LDX $FA
1210  -          CPX #11
1220  -          BNE IR1
1230  -          LDA #03
1240  -          TAX
1250  -          STA $FA
1260  -IR1       JMP WEITER
1270  -;
1280  -IRQ2      JSR TIME       ;IST ZEIT
1290  -          BNE BACK       ;ERREICHT?
1300  -          DEC $FA
1310  -          LDX $FA
1320  -          CPX #$FF
1330  -          BNE WEITER
1340  -          LDA #07
1350  -          TAX
1360  -          STA $FA
1370  -WEITER    LDY #00
1380  -          TXA
1390  -          ASL            ;
1400  -          ASL            ; MAL 8
1410  -          ASL            ;
1420  -          TAX
1430  -W1        LDA DEF,X      ;LADEN UND NEU
1440  -          STA ZDEF,Y     ;DEFINIEREN
1450  -          INX
1460  -          INY
1470  -          CPY #08
1480  -          BNE W1
1490  -BACK      JMP IRQALT     ;ALTE ROUTINE
1500  -;
1510  -TIME      INC $FE
1520  -          LDA $FE
1530  -          CMP SPEED
1540  -          BEQ T1
1550  -          LDA #10
1560  -          RTS
1570  -T1        LDA #00
1580  -          STA $FE
1590  -          RTS
1600  -;
1610  -AUS       SEI
1620  -          LDA #$31       ;ALTE VECTOREN
1630  -          LDY #$EA
1640  -          STA IRQVEC     ;HERSTELLEN
1650  -          STY IRQVEC+1
1660  -          CLI
1670  -          RTS            ;ZURUECK
1680  -;
1690  -SPEED     .BY 0,0
1700  -;
1710  -; **** ZEICHENDEFINITIONEN ****
1720  -;
1730  -DEF       .BY 60,60,24,0,0,0,0,24
1740  -.BY 60,24,0,0,0,0,24,60
1750  -.BY 24,0,0,0,0,24,60,60
1760  -.BY 0,0,0,0,24,60,60,24
1770  -.BY 0,0,0,24,60,60,24,0
1780  -.BY 0,0,24,60,60,24,0,0
1790  -.BY 0,24,60,60,24,0,0,0
1800  -.BY 24,60,60,24,0,0,0,0
1810  -.BY 60,60,24,0,0,0,0,24
1820  -.BY 60,24,0,0,0,0,24,60
1830  -.BY 24,0,0,0,0,24,60,60
</pre>
            <figcaption>HiRes-Scrolling Quelltext</figcaption>
        </figure>
        <div class="binary_download" data-filename="quelltext.prg" data-name="HiRes-Scrolling Quelltext"></div>

        <h2>1520-Plotter als vollwertiger Drucker</h2>

        <p>Dieses kleine Programm (Listing 3) schicktalle Druckausgaben, die zur Geräteadresse 4 gesendet werden, automatisch zum 1520-Plotter mit der Geräteadresse 6. Das heißt, daß fertige Programme nicht mehr mühselig nach OPEN-Befehlen durchkämmt werden müssen, um die Druckerausgaben entsprechend umzulenken. Weiterhin wird der Plotter automatisch auf Kleinschrift gestellt, wenn diese am C 64 eingeschaltet ist.</p>

        <p>Auch läßt sich die Zeilenlänge am Plotter einstellen: »POKE 713,Z:POKE 754,Z&lt;&lt;, wobei folgende Werte für Z zulässig sind:<br>
            0: 80 Zeichen/Zeile (eingestellter Wert)<br>
            1: 40 Zeichen/Zeile<br>
            2: 20 Zeichen/Zeile</p>

        <address class="author">(N.J.W. Cuppen/tr)</address>

        <figure>
            <pre data-filename="1520 als drucker" data-name="1520-Plotter als Drucker"></pre>
            <figcaption>Listing 3. Der 1520-Plotter als vollwertiger Drucker.</figcaption>
        </figure>

        <aside>
            <p>
                Kalauer des Monats:<br>
                »God Save the Queen Komma acht Komma eins!«</p>
        </aside>
    </article>
</body>

</html>