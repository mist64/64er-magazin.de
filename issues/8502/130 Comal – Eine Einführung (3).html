<!DOCTYPE html>
<html lang="de">

<head>
    <title>Comal – Eine Einführung (3)</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../style.css">
    <meta name="author" content="ev">
    <meta name="64er.issue" content="2/85">
    <meta name="64er.pages" content="130-132">
    <meta name="64er.head1" content="Kurs: Programmiersprachen">
    <meta name="64er.head2" content="C 64">
    <meta name="64er.toc_category" content="Kurse">
    <meta name="64er.index_title" content="Comal — Eine Einführung (Teil 3)">
    <meta name="64er.index_category" content="Kurse|Comal">
    <meta name="64er.id" content="comal">
</head>

<body>
    <article>

        <h1>Comal – Eine Einführung (3)</h1>

        <p class="intro">In dieser Folge unserer Comal-Einführung befassen wir uns mit einem der interessantesten Aspekte dieser Programmiersprache, nämlich der Grafik.</p>

        <p>Die Comal-Grafik kann ihre Herkunft von einer anderen Programmiersprache nicht verheimlichen. Befehle wie »SHOWTURTLE« und »TURTLESIZE« sind verräterisch: Die Sprache Logo mit ihrer bekannten Turtle-Grafik stand neben Basic und Pascal Pate beim Entwurf von Comal.</p>

        <p>Die Bezeichnung Turtle-Grafik stammt noch aus den Anfängen von Logo. Turtle ist das englische Wort für »Schildkröte« und bezeichnete ursprünglich eine mechanische Schildkröte, die sich per Computersteuerung über ein großes Blatt Papier bewegte und dabei mit einem Schreibstift eine sichtbare Spur hinterließ. Zur Steuerung dieser »Schildkröte« wurde eine spezielle Programmiersprache entwickelt, mit Befehlen wie »FORWARD«, »BACK«, »LEFT« etc. Das funktionierte einige Zeit ganz gut, aber dann tauchten die ersten Mikrocomputer mit Grafikbildschirmen auf, und die Schildkröte hauchte ihr mechanisches Leben aus und degenerierte zu einem kleinen Dreieck auf einem Grafikbildschirm. Doch die grafische Programmiersprache Logo war geboren und ist seitdem immer weiterentwickelt worden.</p>

        <p>Das Konzept der Turtle-Grafik wurde vollständig in Comal integriert (Tabelle 1). Daneben gibt es auch spezielle Kommandos zum Zeichnen einzelner Punkte oder Linien, und zwar unabhängig von der jeweiligen Turtleposition. Überhaupt wird der gesamte Bereich von Grafik, Farbe und Bildschirmansteuerung beim C 64 durch Comal-Befehle abgedeckt (Tabelle 2), man muß sich nicht wie im V.2-Basic mit merkwürdigen PEEKs und POKEs herumschlagen.</p>

        <figure>
            <table>
                <tbody>
                    <tr>
                        <td>Anweisung</td>
                        <td>Bedeutung</td>
                    </tr>
                    <tr>
                        <td>FORWARD n</td>
                        <td>Turtle n Schritte vorwärts</td>
                    </tr>
                    <tr>
                        <td>BACKn</td>
                        <td>Turtle n Schritte rückwärts</td>
                    </tr>
                    <tr>
                        <td>HOME</td>
                        <td>Turtle auf Grundposition zurücksetzen</td>
                    </tr>
                    <tr>
                        <td>LEFTw</td>
                        <td>Turtle um w Grad links drehen</td>
                    </tr>
                    <tr>
                        <td>RIGHT w</td>
                        <td>Turtle um w Grad rechts drehen</td>
                    </tr>
                    <tr>
                        <td>SETXY x,y</td>
                        <td>Turtle auf die Koordinaten x,y setzen</td>
                    </tr>
                    <tr>
                        <td>SETHEADING w</td>
                        <td>Turtle-Richtung absolut festlegen (w = 0 bedeutet, daß Turtle nach oben zeigt)</td>
                    </tr>
                    <tr>
                        <td>SHOWTURTLE</td>
                        <td>Turtle sichtbar machen</td>
                    </tr>
                    <tr>
                        <td>HIDETURTLE</td>
                        <td>Turtle unsichtbar machen</td>
                    </tr>
                    <tr>
                        <td>PENUP</td>
                        <td>Turtleweg wird nicht mitgezeichnet</td>
                    </tr>
                    <tr>
                        <td>PENDOWN</td>
                        <td>Turtleweg wird mitgezeichnet</td>
                    </tr>
                    <tr>
                        <td>PENCOLOR n</td>
                        <td>Zeichenfarbe n wählen</td>
                    </tr>
                    <tr>
                        <td>TURTLESIZE n</td>
                        <td>Turtlegröße auf n Punkte festlegen</td>
                    </tr>
                </tbody>
            </table>
            <figcaption>Tabelle 1. Befehle für Turtle-Grafik</figcaption>
        </figure>

        <figure>
            <table>
                <tbody>
                    <tr>
                        <td>Anweisung</td>
                        <td>Bedeutung</td>
                    </tr>
                    <tr>
                        <td>BACKGROUND n</td>
                        <td>Hintergrundfarbe n wählen</td>
                    </tr>
                    <tr>
                        <td>BORDER n</td>
                        <td>Rahmenfarbe n wählen</td>
                    </tr>
                    <tr>
                        <td>CLEAR</td>
                        <td>Grafikbildschirm löschen</td>
                    </tr>
                    <tr>
                        <td>DRAWTO x,y</td>
                        <td>Zeichnet eine Linie zum Punkt x,y</td>
                    </tr>
                    <tr>
                        <td>FILL</td>
                        <td>Flächen mit Farbe ausfüllen</td>
                    </tr>
                    <tr>
                        <td>FRAME x1,x2,y1,y2</td>
                        <td>Window festlegen</td>
                    </tr>
                    <tr>
                        <td>FULLSCREEN</td>
                        <td>Ganzer Bildschirm für Grafik</td>
                    </tr>
                    <tr>
                        <td>MOVETO x,y</td>
                        <td>Grafik-Cursor auf x,y setzen</td>
                    </tr>
                    <tr>
                        <td>PLOT x,y</td>
                        <td>Grafikpunkt setzen</td>
                    </tr>
                    <tr>
                        <td>PLOTTEXT x,y,text$</td>
                        <td>Text in Grafikbildschirm einblenden</td>
                    </tr>
                    <tr>
                        <td>SETGRAPHIC</td>
                        <td>Grafik-Modus wählen</td>
                    </tr>
                    <tr>
                        <td>SETTEXT</td>
                        <td>Auf Textbildschirm umschalten</td>
                    </tr>
                    <tr>
                        <td>SPLITSCREEN</td>
                        <td>In Grafikbildschirm zwei Textzeilen reservieren</td>
                    </tr>
                </tbody>
            </table>
            <figcaption>Tabelle 2. Allgemeine Bildschirm- und Grafikbefehle</figcaption>
        </figure>

        <p>Comal kennt drei verschiedene Bildschirmmodi, nämlich den normalen Textmodus (»SETTEXT«), den hochauflösenden Grafikmodus (»SETGRAPHIC 0«) und den Mehrfarben-Grafikmodus (»SETGRAPHIC 1«). Der Textmodus wird auch mit der Funktionstaste fl eingeschaltet, während f5 die Grafik einschaltet. Im hochauflösenden Modus kann mit f3 zusätzlich noch ein Textfenster eingeblendet werden, was beim Experimentieren mit der Turtle-Grafik recht nützlich ist. Die oberen beiden Bildschirmzeilen bilden dann das Textfenster, mit dessen Hilfe man beispielsweise im Direktmodus mit entsprechenden Befehlen die Turtle steuern kann.</p>

        <p>Geben Sie einmal im Direktmodus den Befehl »CLEAR« ein (um den Grafikbildschirm zu löschen) und schalten Sie danach durch Drücken der f3-Taste in die hochauflösende Grafik mit Textfenster um. Sie sehen in der Mitte des ansonsten leeren Bildschirms ein kleines weißes Dreieck, die Turtle. In der linken oberen Bildschirmecke blinkt der Cursor und zeigt damit an, daß die Turtle auf Befehle von Ihnen wartet.</p>

        <h3>So wird die »Schildkröte« bewegt</h3>

        <p>Geben Sie jetzt »FORWARD 50« ein. Die Turtle bewegt sich damit um 50 Einheiten vorwärts und zieht dabei eine Linie längs ihres Weges. Mit »LEFT 90« erreichen Sie eine Drehung der Turtle um 90 Grad nach links. Wenn Sie jetzt nochmals »FORWARD 50« eingeben, bewegt sich die Turtle in die neue Richtung. Soll eine Bildschirmstelle angefahren werden, ohne eine Linie dorthin zu ziehen, dann wird mit dem Kommando »PEN-UP« einfach der symbolische Schreibstift von der Zeichenfläche abgehoben. Die Turtle kann dann nach Belieben über den gesamten Bildschirm dirigiert werden, ohne Spuren zu hinterlassen. Aber keine Angst, nach »PENDOWN« zeichnet sie wieder.</p>

        <p>Wenn Sie es gerne etwas bunter hätten, bitte sehr. »PENCO-LOR« wählt die Schreibfarbe der Turtle, »BORDER« und »BACKGROUND« wählen Rahmen- und Hintergrundfarbe. Erscheint Ihnen die Turtle zu gut genährt, dann können Sie zum Beispiel mit »TURTLESIZE 5« bedenkenlos etwas Speck entfernen. Und sollte Ihnen die Turtle insgesamt nicht ganz geheuer sein, dann tippen Sie einfach »HIDETURTLE« in Ihren Computer ein. Die »Schildkröte« wird sich daraufhin schmollend von der Bildfläche zurückziehen, aber zum Glück wird ihr Wirken dadurch nicht behindert: Aus dem Unsichtbaren befolgt sie weiter Ihre Befehle und zieht fleißig ihre Linien.</p>

        <h3>Kleine Programme mit großer Wirkung</h3>

        <p>Natürlich ist die Grafikerzeugung mit dieser sehr direkten Methode auf die Dauer entschieden zu langwierig. Wenn Sie das kleine Programm aus Listing 1 einmal ausprobieren, werden Sie feststellen, daß effektvolle Grafikprogramme in Comal weder besonders komplex noch langsam zu sein brauchen. Experimentieren Sie ruhig mit ähnlichen Programmen; Sie werden sehr schnell ein gewisses Gespür dafür entwickeln, wie Sie durch Wiederholung einfacher Grundfiguren mit jeweils einem etwas geänderten Parameter interessante grafische Effekte erzielen können.</p>

        <figure>
            TODO
            <figcaption>Listing 1. Eine kleine Demonstration der Turtle Grafik</figcaption>
        </figure>

        <h3>Zugabe: Sprites in Comal programmiert</h3>

        <p>Der große Vorteil der Turtle-Grafik gegenüber dem Zeichnen von Linien nach festen Koordinaten ist ja gerade die erstaunliche Einfachheit, mit der sich recht komplexe Strukturen vom Standpunkt der »Schildkröte« aus darstellen. Mit Comal können Sie wirklich eine »Reise durch die Wunderwelt der Grafik« antreten — auch ohne sich mit Bits und Bytes abzuplagen und mit komplizierten mathematische Formeln zu jonglieren.</p>

        <p>Die Turtle-Grafik ist nur die eine Seite der grafischen Fähigkeiten des C 64 - Comal. Es stehen nämlich zusätzlich eine Reihe von leistungsfähigen Anweisungen zur Erzeugung und Kontrolle von Sprites zur Verfügung.</p>

        <p>Auch bei Sprites wird zwischen Hochauflösung (Hires) und Mehrfarbendarstellung (Multicolor) unterschieden. Ein Hires-Sprite besteht bekanntlich aus 24 x 21 Punkten oder aus 21 Reihen zu je drei Byte. Bei Multicolor-Sprites haben wir nur 12 x 21 Punkte, dafür benötigt jeder Bildpunkt aber intern zwei Bit, da vier verschiedene Farben pro Punkt möglich sind. In beiden Fällen kann die in einem Sprite enthaltene Information in 63 Bytes dargestellt werden. Comal verwendet ein zusätzliches Byte, das angibt, ob es sich um ein Hires-Sprite (Byte 64 = 0) oder um ein Multicolor-Sprite (Byte 64 &lt; > 0) handelt. Beide Spritearten werden im übrigen mit völlig gleichartigen Befehlen angesprochen.</p>

        <p>Zur Spriteerzeugung dient der Befehl »DEFINE«. Als Parameter wird eine Definitions-Nummer sowie ein String angegeben. Die Definitions-Nummer kann irgendeine Zahl von 0 bis 95 sein, denn Comal kann bis zu 96 verschiedene Spritemuster verwalten. Der anzugebende String muß eine Länge von 64 Zeichen haben und das Punktmuster des Sprites enthalten. Das Beispielprogramm in Listing 2 zeigt, wie man in Comal mit Sprites umgeht.</p>

        <figure>
            TODO
            <figcaption>Listing 2. Turtle-Grafik und Sprites: So einfach und übersichtlich ist die Programmierung</figcaption>
        </figure>

        <p>Wichtig ist es, genau zwischen der Definitions-Nummer eines Sprites und der eigentlichen Spritenummer zu unterscheiden. Es können hardwarebedingt ja immer nur acht Sprites gleichzeitig auf dem Bildschirm sein. Wird die Turtle benutzt, die selber ein Sprite ist, dann verringert sich diese Anzahl auf sieben.</p>

        <p>Mit dem »IDENTIFY«-Kommando wird die Beziehung zwischen Sprite-Nummer und Definitions-Nummer hergestellt. »IDENTIFY 1,30« bewirkt beispielsweise, daß das Sprite mit der Definitions-Nummer 30 als Sprite 1 auf dem Bildschirm dargestellt wird. So kann sehr schnell zwischen verschiedenen Sprites umgeschaltet werden, was zur Erzeugung von zeichentrickähnlichen Effekten benutzt werden kann.</p>

        <p>Wie aus Tabelle 3 zu ersehen ist, gibt es eine Vielzahl von weiteren Comal-Befehlen speziell zur Sprite-Kontrolle. Die Wirkungsweise solcher Anweisungen wie »SPRITECOLOR« oder »SPRITEPOS« dürfte wohl jedem verständlich sein, der sich schon einmal von Basic aus an die Spriteprogrammierung gewagt hat.</p>

        <figure>
            <table>
                <tbody>
                    <tr>
                        <td>Anweisung</td>
                        <td>Bedeutung </td>
                    </tr>
                    <tr>
                        <td>DATACOLLISION n,b</td>
                        <td>Sprite-Hintergrund- Kollisionsabfrage für Sprite n (die Variable b wird 1, falls Kollision, sonst b=0)</td>
                    </tr>
                    <tr>
                        <td>SPRITECOLLISION n,b</td>
                        <td>Sprite-Sprite-Kollisionsabfrage für Sprite n (b wird 1, falls Kollision, sonst b=0)</td>
                    </tr>
                    <tr>
                        <td>DEFINE d,x$</td>
                        <td>Der Inhalt der Stringvariablen x$ definiert ein Sprite mit Definitionsnummer d</td>
                    </tr>
                    <tr>
                        <td>IDENTIFY n,d</td>
                        <td>Ordnet dem mit Nummer d definierten Sprite die Spritenummer n zu</td>
                    </tr>
                    <tr>
                        <td>PRIORITY n,p</td>
                        <td>Hintergrund hat Priorität vor Sprite n (p=0), umgekehrt für P=I</td>
                    </tr>
                    <tr>
                        <td>SPRITEBACK a,b</td>
                        <td>Setzt a und b als zusätzliche Farben für Multicolor-Sprites</td>
                    </tr>
                    <tr>
                        <td>HIDESPRITE n</td>
                        <td>Sprite n nicht anzeigen</td>
                    </tr>
                    <tr>
                        <td>SHOWSPRITE n</td>
                        <td>Sprite n anzeigen</td>
                    </tr>
                    <tr>
                        <td>SPRITECOLOR n,c</td>
                        <td>Farbe c für Sprite n wählen</td>
                    </tr>
                    <tr>
                        <td>SPRITEPOSITION n,x,y</td>
                        <td>Sprite n auf Position x,y setzen</td>
                    </tr>
                    <tr>
                        <td>SPRITESIZE n,x,y</td>
                        <td>Sprite n in x- oder y-Richtung vergrößern</td>
                    </tr>
                </tbody>
            </table>
            <figcaption>Tabelle 3. Sprite-Befehle</figcaption>
        </figure>

        <h3>Comal oder Basic?</h3>

        <p>Wie die drei Folgen unserer kleinen Comal-Einführung hoffentlich gezeigt haben, hat Comal dem Commodore V.2-Basic einiges voraus. Die von Pascal entlehnte Programmstrukturierung mittels Prozeduren und die aus Logo stammende Turtle-Grafik haben sich mit dem aus Basic übernommenen Konzept einer benutzerfreundlichen, interaktiven Programmiersprache zu einer gelungenen Synthese zusammengefügt. Die hier besprochene Comal-Version 0.14 ist dabei nur als eine Art Vorabversion zu werten. Eine nochmals wesentlich erweiterte und verbesserte Version 2.0 wird von Commodore Dänemark bereits als Steckmodul (64 KByte ROM, 30 KByte RAM frei) vertrieben. Es ist zu hoffen, daß auch Commodore Deutschland diese zukunftsweisende Programmiersprache bald anbieten wird.

        <address class="author">(ev)</address>

        <p>Info: Comal-Literatur:<br>
            Borge Christensen, Heiko Wolgast: Comal 0.14-Handbuch, 80 Seiten, Verlag Schmidt &amp; Klaunig, Ringstraße, 2300 Kiel.<br>
            Borge Christensen: Strukturierte Programmierung mit Comal, 230 Seiten, Verlag R. Oldenbourg, München, ISBN 3-486-26901-1</p>

    </article>

</body>

</html>