<!DOCTYPE html>
<html lang="de">

<head>
    <title>ON ERROR GOTO</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../style.css">
    <meta name="author" content="Kunz, tr">
    <meta name="64er.issue" content="Sonderheft 5/85">
    <meta name="64er.pages" content="103">
    <meta name="64er.head1" content="Basic-Erweiterungen">
    <meta name="64er.toc_category" content="Tips und Tricks">
    <meta name="64er.toc_title" content="On Error Goto">
    <meta name="64er.id" content="on_error_goto">
</head>

<body>
    <article>
        <h1>ON ERROR GOTO</h1>
        <p class="intro">Routinen, die bei einem auftretenden Programmfehler zu einer bestimmten Zeile verzweigen, sind inzwischen Standardausrüstung jeder guten Basic-Erweiterung. Das vorliegende Maschinenprogramm ist nur 88 Byte lang.</p>

        <p>Um einen Fehler während des Programmlaufs abzufangen, kennen viele Computer den Befehl ON ERROR GOTO. Mit diesem kurzen Maschinenprogramm kann auch Ihr C 64 auf Fehler im Programm reagieren.</p>

        <p>Nachdem das Programm (Listing 1) im Speicher steht, kann es mit SYS 50000, ZL aktiviert werden. Dabei bedeutet ZL die Zeilennummer, zu der bei einem Fehler verzweigt werden soll. Die Fehlernummer wird dann in Speicherstelle 2 gespeichert und kann mit PEEK(2) abgefragt werden. Tabelle 1 zeigt, welche Nummer welcher Fehlermeldung entspricht. Die Zeile, in der der Fehler auftrat, wird in Speicherstelle 249 und 250 gespeichert. Damit Sie zu der fehlerhaften Zeile zurückspringen können, wurde noch die Routine »GOTO X« eingebaut. Damit läßt sich zu einer berechneten Zeile springen. Aufgerufen wird diese Routine mit SYS 50076, ZL. Schauen wir uns einmal das Beispiel ab Zeile 200 im Basic-Lader an. In Zeile 210 wird mit SYS 50000, 1000 die Fehlerbehandlungsroutine auf Zeile 1000 gelegt. In Zeile 220 wird der Benutzer aufgefordert, eine Zahl einzugeben. Solange diese Zahl positiv ist, wird in Zeile 230 die Wurzel aus dieser Zahl errechnet und ausgegeben. Bei einer negativen Zahl wird zur Zeile 1000 verzweigt. Hier wird die Fehlernummer ausgegeben. In diesem Falle 14. In Zeile 1010 wird nun die Zeile errechnet, in der der Fehler auftrat und ausgegeben. Zeile 1020 schließlich ruft die »GOTO X«-Routine auf und springt in die Zeile ZL —10.</p>

        <p>Listing 2 zeigt den dokumentierten Assemblerteil der Routine.</p>

        <address class="author">(Kunz/tr)</address>

        <figure>
            <table class="plain">
                <thead>
                    <tr>
                        <th>Fehlernummer</th>
                        <th>Fehlermeldung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>TOO MANY FILES</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>FILE OPEN</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>FILE NOT OPEN</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>FILE NOT FOUND</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>DEVICE NOT PRESENT</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>NOT INPUT FILE</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>NOT OUTPUT FILE</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>MISSING FILENAME</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>ILLEGAL DEVICE NUMBER</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>NEXT WITHOUT FOR</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>SYNTAX</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>RETURN WITHOUT GOSUB</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>OUT OF DATA</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>ILLEGAL QUANTITY</td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td>OVERFLOW</td>
                    </tr>
                    <tr>
                        <td>16</td>
                        <td>OUT OF MEMORY</td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td>UNDEF'D STATEMENT</td>
                    </tr>
                    <tr>
                        <td>18</td>
                        <td>BAD SUBSCRIPT</td>
                    </tr>
                    <tr>
                        <td>19</td>
                        <td>REDIM'D ARRAY</td>
                    </tr>
                    <tr>
                        <td>20</td>
                        <td>DIVISION BY ZERO</td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>TYPE MISMATCH</td>
                    </tr>
                    <tr>
                        <td>23</td>
                        <td>STRING TOO LONG</td>
                    </tr>
                    <tr>
                        <td>24</td>
                        <td>FILE DATA</td>
                    </tr>
                    <tr>
                        <td>25</td>
                        <td>FORMULA TOO COMPLEX</td>
                    </tr>
                    <tr>
                        <td>27</td>
                        <td>UNDEF'D FUNCTION</td>
                    </tr>
                    <tr>
                        <td>28</td>
                        <td>VERIFY</td>
                    </tr>
                    <tr>
                        <td>29</td>
                        <td>LOAD</td>
                    </tr>
                </tbody>
            </table>
            <figcaption>Tabelle 1. Die Fehlermeldungen des Betriebssystems, jeweils mit dem Zusatz »ERROR«.</figcaption>
        </figure>

        <figure>
            <pre data-filename="on error goto" data-name="On-Error"></pre>
            <figcaption>Listing 1. Der Basic-Lader zu »On-Error«. Bitte verwenden Sie zur Eingabe den neuen Checksummer (Seite 6.)</figcaption>
        </figure>
    </article>
</body>

</html>
