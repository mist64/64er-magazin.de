<!DOCTYPE html>
<html lang="de">

<head>
    <title>Unterprogrammebibliothek: Sieger mit Maske</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../style.css">
    <meta name="author" content="Jacques Effenberg, gk">
    <meta name="64er.issue" content="10/84">
    <meta name="64er.pages" content="172-176">
    <meta name="64er.head1" content="Unterprogramm">
    <meta name="64er.head2" content="C 64">
    <meta name="64er.toc_category" content="Wettbewerbe">
    <meta name="64er.index_title" content="Sieger mit Maske — Maskenerstellungsprogramm">
    <meta name="64er.index_category" content="Wettbewerbe|Unterprogramm">
    <meta name="64er.id" content="unterprogramme">
</head>

<body>
    <article>
        <h1>Unterprogrammebibliothek: Sieger mit Maske</h1>

        <p class="intro">In dieser Ausgabe wird zum erstenmal ein Gewinner unseres Programmierwettbewerbs »Unterprogrammbibliothek« vorgestellt. Das Programm »Maske« bietet eine komfortable Routine zur Eingabe und Programmierung von Bildschirmmasken.</p>

        <figure>
            <img src="172-1.png" alt="">
            <figcaption>Jacques Effenberg, der Autor des Programms</figcaption>
        </figure>

        <p>Die Anzahl der eingegangenen Unterprogramme und deren unterschiedliche Thematik machte eine Bewertung natürlich nicht einfach. Wenn Ihr Programm diesmal nicht vorgestellt wird, so bedeutet das keine Abqualifikation. Damit Sie als Leser aber auch in den Genuß umfangreicherer Unterprogramme kommen, werden wir gelegentlich zusätzlich zu unserem »Unterprogramm des Monats« andere interessante Einsendungen veröffentlichen.</p>

        <p>Der Autor dieses Programms ist ein waschechter Berliner. Jacques Effenberg ist 35 Jahre alt und von Beruf Maschinenschlosser. Im März 1983 kaufte er sich einen C 64. Nachdem er sich ein knappes Jahr mit Basic versuchte, stieg er auf Assemblerprogrammierung um, weil er mit Maschinensprache viele Probleme besser lösen konnte. Zum Programm selbst:</p>

        <p>Das Programm Maske hat die Aufgabe, die Programmierung von Bildschirmmasken zu vereinfachen. Der erste Befehl erstellt horizontale und vertikale Linien. Die an den Schnittstellen benötigten Zeichen werden vom Programm ermittelt und eingesetzt. Der zweite Befehl löscht vom Benutzer definierte Felder in der Bildschirmmaske. Der dritte Befehl dient dazu, Text an bestimmte Stellen des Bildschirms zu drucken. Das Maschinenprogramm liegt im Speicherbereich von 49152 bis 50539. Eigene Fehlermeldungen und das Listen der Basic-Zeile in der der Fehler vorkommt, erleichtern dem Benutzer die Arbeit.</p>

        <h2>Parameterübergabe, Fehlermeldungen</h2>

        <h3>1) Linien zeichnen</h3>

        <p>Der Befehl für Linien zeichnen wird in Basic wie folgt programmiert:<br />
            SYS 49152, Richtung, Zeile, Spalte, Länge, Farbe<br />
            1a) Richtung<br />
            Für eine horizontale Linie geben Sie eine 0 und für eine vertikale Linie eine 1 ein. Bei einer Zahl größer als 1 meldet sich der Computer mit der Fehlermeldung:</p>

        <p>Richtung Wert zu groß (0 bis 1) in:<br />
            und listet die Zeile Ihres Basic-Programms.<br />
            1b) Zeile<br />
            Die Zeilenangabe liegt im Bereich von 1 bis 25. Bei Werten von kleiner als 1 oder größer als 25 lautet die Fehlermeldung:</p>

        <p>Zeilenwert kleiner 1 oder größer 25 in:<br />
            und die Basic-Zeile wird gelistet.</p>

        <p>1c) Spalte</p>

        <p>Die Werte für die Spaltenangabe liegen im Bereich von 1 bis 40 und Werte kleiner als 1 oder größer als 40 ergeben die Fehlermeldung:</p>

        <p>Spaltenwert kleiner 1 oder größer 40 in:<br />
            sowie eine Anzeige der Zeile.<br />
            1d) Die Länge kann im Bereich von 1 bis 40 für horziontale Linien und für vertikale Linien im Bereich von 1 bis 25 liegen. Werte, die nicht in diesem Zahlenbereich liegen, führen zu der Fehlermeldung:</p>

        <p>Länge Linie zu klein oder zu groß in:<br />
            Wollen Sie zum Beispiel eine horizontale Linie zeichnen, mit dem Spaltenwert 20 und geben als Länge einen Wert von 22 an, so führt das zur Meldung:</p>

        <p>Spalte + Länge Linie größer 40 in:<br />
            da der Bereich von 40 möglichen Spalten überschritten wird.</p>

        <p>Eine vertikale Linie zum Beispiel ab Zeile 10 und mit der Länge 17 würde die Fehlermeldung:</p>

        <p>Zeile + Länge Linie größer 25 in:<br />
            ergeben, da das Ergebnis von 10 + 17 den möglichen Bereich von 25 Zeilen überschreitet. In allen drei Beispielen erfolgt ein LISTen der Basic-Zeile.<br />
            1e) Farbe<br />
            Für die Farbwerte würden Zahlen im Bereich von 0 bis 15 in Frage kommen. Werte größer als 15 führen zu keiner Fehlermeldung.</p>

        <h3>2) Felder löschen</h3>

        <p>Um bestimmte Bereiche auf dem Bildschirm zu löschen, müssen Sie den Befehl:</p>

        <p>SYS50083, abZeile, bisZeile, Spalte, Länge eingeben.<br />
            2a) ab Zeile, bis Zeile</p>

        <p>Wollen Sie zum Beispiel die ersten fünf Zeilen auf Ihrem Bildschirm komplett löschen, müßte der Befehl wie folgt aussehen:<br />
            SYS 50083,1,5,1,40<br />
            also ab Zeile 1 bis Zeile 5, ab Spalte 1 und 40 Zeichen lang. Ist nur eine Zeile zu löschen, dann ist der Wert ab Zeile gleich dem Wert bis Zeile.</p>

        <p>Geben Sie zum Beispiel für ab Zeile 10 und bis Zeile 2 ein, so erfolgt die Fehlermeldung:</p>

        <p>Zeile 1 ist größer als Zeile 2 in:<br />
            sowie ein Listen der Basic-Zeile.<br />
            2b) Zahlenbereich</p>

        <p>Für die Bereichsangabe gelten die Werte aus Absatz 1, sowie bei Überschreitungen auch die Fehlermeldungen.</p>

        <h3>3) Print</h3>

        <p>Für die gezielte Ausgabe eines Textes auf dem Bildschirm lautet der Befehl:</p>

        <p>SYS 50242, Zeile, Spalte, Farbe, ”Text”<br />
            3a) Zeile, Spalte, Farbe</p>

        <p>Alle unter Absatz 1 beschriebenen Zahlenbereiche für die Angabe bei Zeile, Spalte, Farbe gelten auch hier. Ebenso treffen auch die dort erwähnten Fehlermeldungen bei einer Bereichsüberschreitung zu.<br />
            3b) &ldquo;Text”</p>

        <p>Hier kann all das stehen, was Sie auf dem Bildschirm ausgeben wollen.<br />
            Ein Beispiel:<br />
            SYS 50242,1,20,2,”Probe”<br />
            es wird in diesem Fall in der ersten Zeile ab Spalte 20 das Wort »Probe« in roter Farbe auf dem Bildschirm ausgegeben. Sie könnten auch vorher im Programm festlegen, daß D$ = ’’Probe” ist, schreiben dann SYS 50242,1,20,2, D$ und erhalten das gleiche Ergebnis.</p>

        <p>Hatten Sie vor diesem Befehl eine grüne Cursorfarbe, dann wird, nach dem Ausgeben des Wortes »Probe« in roter Farbe, Ihre Cursorfarbe wieder grün sein.</p>

        <h3>4) Erklärungen zum DATA-Programm</h3>

        <p>4a) Programmablauf</p>

        <p>In Zeile 1000 werden nach der Dimensionierung der Variablen P die 116 Prüfsummen für das Maschinenprogramm in P(I) eingelesen. Jede Prüfsumme ist das Ergebnis einer Addition von zwölf DATA-Werten. Die Variable SP addiert die Prüfsummen. Zeile 1130 überprüft die Gesamtsumme und gibt bei einer Differenz die Meldung »Fehler Prüfsumme« aus. Das Programm wird beendet.</p>

        <p>Das Maschinenprogramm wird ab Zeile 1140 eingelesen und gespeichert. Die Variablen S und SI addieren und ZI zählt die DATA-Werte.</p>

        <p>Ist ZI = 12 wird in Zeile 1160 die Variable S mit der jeweiligen Prüfsumme P (PI) verglichen. Ist S ungleich P (PI), verzweigt das Programm zur Zeile 1210.</p>

        <p>In Zeile 1190 wird SI mit der Gesamtsumme aller DATAs verglichen. Bei einer Differenz ergibt sich ein Fehler in der letzten DATA-Reihe. Es kommt zur Ausgabe der Meldung »Fehler letzte Reihe DATA«.</p>

        <p>Sind alle Werte richtig eingegeben, wird in Zeile 1200 nach der Meldung »OK« das Programm beendet. Beim Einlesen von DATA-Zeilen notiert sich der Interpreter die abzuarbeitende Zeilennummer in den Speicherstellen 63 und 64 der Zeropage. War in Zeile 1160 die Summe von 12 DATA-Werten und die Prüfsumme P (PI) ungleich, so wird in Zeile 1210 die Zeilennummer in der der Fehler auftrat in Z$ festgehalten.</p>

        <p>Dann wird der Bildschirm gelöscht und in Zeile 1240 die Meldung »Fehler in Zeile« Z$ ausgegeben. In den Zeilen 1250 bis 1260 wird der Befehl »LIST« und die Zeilennummer in den Tastaturpuffer gePOKEt. Dazu kommt in Zeile 1270 noch der Befehl »RETURN« und in der Speicherstelle 198 wird dem Interpreter mitgeteilt, wieviel Stellen im Tastaturpuffer belegt sind.</p>

        <p>Nach dem Befehl »END« in Zeile 1280 und der Ausgabe von »READY« befindet sich der Computer in einer Warteschleife, in der auch die Speicherstelle 198 abgefragt wird. Da der Wert in 198 größer als 0 ist, arbeitet der Interpreter jetzt den Tastaturpuffer in folgender Reihenfolge (zum Beispiel bei Fehler in Zeile 1290) ab:<br />
            Speicher 631 Wert 76 = L<br />
            Speicher 632 Wert 105 = i (L + Shift i = Kurzzeichen für LIST)<br />
            Speicher 633 Wert 49 = 1<br />
            Speicher 634 Wert 50 = 2<br />
            Speicher 635 Wert 57 = 9<br />
            Speicher 636 Wert 48 = 0<br />
            Speicher 637 Wert 13 = Return<br />
            also LIST 1290 und die Zeile mit dem Fehler wird gelistet.<br />
            4b) Programmverbindung</p>

        <p>Haben Sie alle DATA-Werte richtig eingegeben und der Computer hat sich nach einiger Zeit mit »OK« wieder gemeldet, so können Sie jetzt die Zeilen 1000 bis 1280 löschen. Dann geben Sie die folgende Zeile ein: 1280 FOR I = 49152 TO 50539:READ X : POKE I, X:NEXT:NEW<br />
            und speichern das Programm ab.</p>

        <p>Wenn Sie das Programm in Zukunft benutzen, dann wird nach dem Einlesen des Maschinenprogramms in den Speicherbereich 49152 bis 50539 das DATA-Programm gelöscht, und Sie haben den ganzen Basic-Speicher für Ihr eigenes Programm zur Verfügung.</p>

        <p>Sind Sie Besitzer eines Diskettenlaufwerkes, dann können Sie in der Zeile 1280 statt »NEW« den Befehl LOAD ”&hellip;”,8 schreiben, und das DATA-Programm lädt nach dem Einlesen der DATA-Zeilen Ihr eigenes Programm gleich nach.</p>

        <p>Zwischen ”&hellip;” muß der Name Ihres Programms stehen. Wenn Sie diese Variante wählen, dann muß aber die erste Zeile Ihres eigenen Programms wie folgt aussehen:<br />
            10 POKE 45, PEEK (174): POKE 46, PEEK (175): CLR<br />
            Durch diese Lösung wird das DATA-Programm auch gelöscht und Ihr Programm wird gleich nachgeladen und startet sich selbst.</p>

        <address class="author">(Jacques Effenberg/gk)</address>

        <figure>
            <pre data-filename="maske datas" data-name="Maske Demo"></pre>
            <figcaption>Dieses Demo-Programm zeigt anschaulich die Möglichkeiten des Unterprogramms</figcaption>
        </figure>
        <figure>
            <pre data-filename="demo_maske" data-name="Maske"></pre>
            <figcaption>Das Programm »Maske« in Form von DATA-Zeilen</figcaption>
        </figure>

    </article>

</body>

</html>
